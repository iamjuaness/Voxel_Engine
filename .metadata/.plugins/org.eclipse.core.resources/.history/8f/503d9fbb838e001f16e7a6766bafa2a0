package render_engine;

import org.lwjgl.opengl.Display;
import org.lwjgl.opengl.GL11;
import org.lwjgl.util.vector.Matrix4f;

import entities.Entity;
import shaders.StaticShader;

/**
 * MasterRenderer is responsible for handling the rendering setup and
 * preparation for the game scene. It sets up the background color and clears
 * the screen before rendering new frames. Additionally, it handles the
 * rendering of 3D entities.
 */
public class MasterRenderer {
	
	public MasterRenderer(StaticShader shader) {
		
		createProjectionMatrix();
		shader
		
	}
	
	Matrix4f projectionMatrix;
	
	private static final float FOV = 70f;
	private static final float NEAR_PlANE = 0.1f;
	private static final float FAR_PLANE = 10000f;

	/**
	 * Prepares the OpenGL context for rendering by setting the clear color and
	 * clearing the color buffer. This method should be called before rendering each
	 * new frame to ensure that the screen is cleared and ready for drawing.
	 * 
	 * - The background color is set using `glClearColor`, which defines the color
	 * that the screen will be cleared to. The values are RGB and alpha
	 * (transparency). In this example, the color is a light blue (0.4, 0.7, 1.0,
	 * 1). - `glClear` is called with `GL_COLOR_BUFFER_BIT` to clear the color
	 * buffer, effectively resetting the screen with the specified background color.
	 */
	public void prepare() {
		// Set the clear color to a light blue with RGB values (0.4, 0.7, 1.0) and full
		// opacity (1).
		GL11.glClearColor(0.4f, 0.7f, 1.0f, 1);

		// Clear the color buffer to apply the new clear color, preparing the screen for
		// drawing.
		GL11.glClear(GL11.GL_COLOR_BUFFER_BIT);
	}

	/**
	 * Renders the specified Entity by delegating the rendering process to
	 * the EntityRenderer. This method accepts an Entity and uses the static
	 * render method of the EntityRenderer class to draw the model associated 
	 * with the entity.
	 * 
	 * @param entity The Entity to be rendered, which contains the model's 
	 *               VAO ID, vertex count, and texture data.
	 * @param shader The StaticShader used for rendering the model, allowing 
	 *               transformation and texture application.
	 */
	public void render(Entity entity, StaticShader shader) {
	    // Delegate the rendering of the model to the static render method in
	    // EntityRenderer.
	    EntityRenderer.render(entity, shader);
	}

	public void createProjectionMatrix() {
		
		projectionMatrix = new Matrix4f();
		
		
		float aspect = (float) Display.getWidth() / (float) Display.getHeight();
		float yScale = (float) (1f / Math.tan(Math.toRadians(FOV / 2f)));
		float xScale = (float) yScale / aspect;
		float zp = FAR_PLANE + NEAR_PlANE;
		float zm = FAR_PLANE - NEAR_PlANE;
		
		projectionMatrix.m00 = xScale;
		projectionMatrix.m11 = yScale;
		projectionMatrix.m22 = -zp / zm;
		projectionMatrix.m23 = -1;
		projectionMatrix.m32 = -(2 * FAR_PLANE * NEAR_PlANE) / zm;
		projectionMatrix.m33 = 0;
	}

}
