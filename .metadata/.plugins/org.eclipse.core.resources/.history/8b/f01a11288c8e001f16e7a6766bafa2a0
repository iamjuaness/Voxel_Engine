package juancraft;

import org.lwjgl.opengl.Display;
import org.lwjgl.util.vector.Vector3f;

import entities.Camera;
import entities.Entity;
import models.RawModel;
import models.TexturedModel;
import render_engine.DisplayManager;
import render_engine.Loader;
import render_engine.MasterRenderer;
import shaders.StaticShader;
import textures.Modeltexture;

/**
 * The MainGameLoop class is the entry point of the JuanCraft game application.
 * It initializes the display, prepares the rendering engine, and enters the
 * main game loop where rendering occurs until the display is closed.
 */
public class MainGameLoop {

    // Static reference to the Loader instance for use throughout the application.
    public static Loader loader1 = null;
    public static StaticShader shader1 = null;

    /**
     * The main method that starts the game. It initializes the display, creates a
     * MasterRenderer for rendering, and enters the game loop.
     * 
     * @param args Command line arguments (not used in this application).
     */
    public static void main(String[] args) {
        // Create and initialize the display window for the game.
        DisplayManager.createDisplay();

        // Create a Loader instance for loading models and shaders.
        Loader loader = new Loader();
        loader1 = loader; // Store the loader instance for potential future use.
        StaticShader shader = new StaticShader();
        shader1 = shader; // Store the shader instance for potential future use.

        // Instantiate the MasterRenderer to handle rendering operations.
        MasterRenderer renderer = new MasterRenderer(shader1);
        
        // Define vertices for a simple square model.
        float[] vertices = { 
            -0.5f, 0.5f, 0, // Top left corner of the square
            -0.5f, -0.5f, 0, // Bottom left corner of the square
            0.5f, -0.5f, 0, // Bottom right corner of the square
            0.5f, 0.5f, 0 // Top right corner of the square
        };

        // Define indices for the square's two triangles.
        int[] indices = { 
            0, 1, 2, // First triangle (top left, bottom left, bottom right)
            2, 3, 0 // Second triangle (bottom right, top right, top left)
        };

        // Define texture coordinates (UV mapping) for the vertices.
        float[] uv = { 
            0, 0, // Top-left corner of the texture
            0, 1, // Bottom-left corner of the texture
            1, 1, // Bottom-right corner of the texture
            1, 0 // Top-right corner of the texture
        };

        // Load the vertices, indices, and UV coordinates into a RawModel.
        RawModel model = loader.loadToVao(vertices, indices, uv);

        // Load a texture from the specified file and create a Modeltexture object.
        Modeltexture texture = new Modeltexture(loader.loadTexture("dirtTex"));

        // Create a TexturedModel object using the loaded texture and the 3D model.
        TexturedModel texturedModel = new TexturedModel(model, texture);

        // Create an Entity object with the textured model, positioned at the origin (0, 0, -1)
        // with no rotation (0, 0, 0) and a scale factor of 1.
        Entity entity = new Entity(texturedModel, new Vector3f(0, 0, -1), 0, 0, 0, 1);

        // Create a Camera object positioned at the origin with no rotation.
        Camera camera = new Camera(new Vector3f(0, 0, 0), 0, 0, 0);

     // Main game loop, which runs continuously until the display requests to close.
        while (!Display.isCloseRequested()) {
            // Prepare the rendering for the current frame (e.g., clear the screen).
            renderer.prepare();
            
            // Call the move method of the camera to update its position based on input.
            camera.move(); // Update camera position based on user input
            
            // Update the entity's position, scale, and rotation.
            entity.increasePosition(0f, 0, 0); // Update the entity's position
            entity.increaseScale(0f); // Scale remains constant
            entity.increaseRotation(0, 0, 0f); // Rotation remains constant

            // Start using the shader program for rendering the entities.
            shader.start();
            
            // Load the camera view matrix into the shader.
            shader.loadViewMatrix(camera);

            // Render the loaded entity using the renderer.
            renderer.render(entity, shader);

            // Stop using the shader after rendering.
            shader.stop();

            // Update the display (sync frame rate and render new frame).
            DisplayManager.updateDisplay();
        }


        // Close the display and clean up resources when the loop exits.
        DisplayManager.closeDisplay();
    }
}
